library(pdftools)
text <- pdf_text("NCRC_HOLC.pdf")
text <- text[26:28]
text2 <- strsplit(text, "\n")
text2[[1]][6]

cities1 <- as_tibble(text2[[1]][6:49])
cities2 <- as_tibble(text2[[2]][5:49])
cities3 <- as_tibble(text2[[3]][5:30])

read.table(text = test)

test<- str_extract_all(as.character(peak), "[A-Z]+")


cities1 <- read.table(fill = T, header = F, text = "
                       1 BINGHAMPTON_NY          100%         100%        0%          0%      96%      57%     33%    100%   0.39  0.76  0.33 0.77 0.50      1     0%   93%
                       2 TRENTON                  33%          45%       47%       100%       58%      53%     55%    100%   0.61  0.25  0.59 0.29 0.49      1    96%   94%
                      3 BUFFALO                  97%          79%       49%         52%      92%      52%     82%     95%   0.69  0.29  0.52 0.53 0.46      1    42%   85%
                      4 STAMFORD                 69%          72%       82%       100%       69%      67%     95%     94%   0.59  0.39  0.53 0.42 0.52      1    97%   84%
                      5 ROCHESTER                99%          68%       44%         92%      99%      72%     57%     93%   0.66  0.31  0.58 0.37 0.49      1    90%   80%
                      6 EAST_HARTFORD            99%          35%       87%         88%      93%      28%     85%     90%   0.63  0.24  0.58 0.31 0.46      1    84%   71%
                      7 ALBANY                   99%          88%       18%         47%      99%      71%     41%     89%   0.56  0.50  0.40 0.62 0.43      1    39%   70%
                      8 HOLYOKE                 100%          82%        7%         10%      95%      24%     27%     87%   0.39  0.59  0.52 0.45 0.44      1    13%   68%
                      9 NEW_HAVEN                75%          87%       50%         83%    100%       67%     49%     87%   0.61  0.31  0.55 0.35 0.52      1    78%   67%
                      10 ELMIRA                  100%         100%        0%          0%    100%       73%     70%     77%   0.43  0.70  0.28 0.76 0.46      1     0%   46%
                      1 SYRACUSE                 98%          81%       38%         46%      89%      59%     72%     77%   0.57  0.40  0.43 0.52 0.51      1    35%   45%
 2 BOSTON_CITY              93%          90%       56%         55%       0%      93%     54%     72%   0.68  0.23  0.57 0.34 0.54      1    46%   34%
                      3 MANCHESTER              100%         100%        0%          0%    100%       57%     44%     71%   0.35  0.78  0.37 0.76 0.43      1     0%   33%
                      4 ATLANTIC_CITY            99%          65%       46%         76%    100%       98%     48%     71%   0.75  0.19  0.63 0.28 0.55      1    67%   33%
                      5 PITTSBURGH              100%          89%       26%         32%    100%       82%     58%     70%   0.64  0.43  0.27 0.73 0.53      1    22%   28%
                      6 JOHNSTOWN                 0%         100%        0%          0%       0%      84%     47%     67%   0.57  0.77  0.29 0.85 0.45      1     0%   25%
                      7 ERIE                    100%         100%       15%         31%    100%       81%     43%     64%   0.57  0.59  0.43 0.66 0.45      1    19%   19%
                      8 UTICA                   100%          98%       14%         10%      90%      89%     39%     63%   0.57  0.56  0.51 0.60 0.48      1    12%   19%
                      9 PHILADELPHIA             70%          64%       51%         69%      94%      80%     51%     61%   0.74  0.16  0.65 0.26 0.48      1    59%   18%
                      10 NEW_CASTLE              100%         100%       10%         32%    100%       97%     39%     60%   0.54  0.74  0.25 0.87 0.47      1    19%   17%
                      1 NEW_YORK_CITY            91%          56%       67%         69%      95%      71%     34%     53%   0.81  0.10  0.64 0.19 0.55      1    57%   11%
 2 NEW_YORK_MSA             91%          78%       55%         68%      96%      88%     30%     52%   0.79  0.13  0.62 0.23 0.51      1    54%   10%
                      3 BOSTON_MSA               99%          94%       14%         17%      99%      91%     31%     42%   0.63  0.36  0.57 0.44 0.48      1    13%    7%
                      4 ALTOONA                 100%         100%        0%          0%    100%       92%     22%     35%   0.34  0.92  0.20 0.93 0.45      1     0%    4%
                      5 HAMILTON                100%         100%        6%         56%    100%       33%     92%    100%   0.45  0.00  0.47 0.00 0.44      2    43%   93%
                      6 WARREN                  100%         100%       18%         90%    100%       88%     84%    100%   0.38  0.58  0.15 0.70 0.48      2    83%   94%
                      7 KENOSHA                 100%         100%       26%         36%    100%       59%     88%     99%   0.44  0.58  0.37 0.60 0.43      2    18%   93%
                      8 CANTON                  100%          91%       24%         80%      89%      46%     88%    100%   0.43  0.61  0.24 0.73 0.45      2    69%   95%
                      9 LORAIN                    0%          91%       50%         59%       0%      60%     94%    100%   0.40  0.46  0.39 0.47 0.45      2    47%   97%
                      10 DECATUR                  88%          83%       36%         50%      86%      25%     78%     98%   0.49  0.52  0.27 0.67 0.46      2    38%   93%
                      11 WICHITA                  57%          84%       30%         42%      57%      73%     72%     98%   0.54  0.37  0.36 0.47 0.46      2    30%   93%
                      12 GRAND_RAPIDS            100%          85%       12%         47%    100%       81%     44%     96%   0.50  0.48  0.49 0.48 0.46      2    34%   92%
                      13 AURORA                   86%          41%       89%         96%      87%      42%     85%     96%   0.29  0.34  0.46 0.24 0.43      2    90%   91%
                        3 GRAND_RAPIDS            100%          85%       12%         47%    100%       81%     44%     96%   0.50  0.48  0.49 0.48 0.46      2    34%   92%
 4 AURORA                   86%          41%       89%         96%      87%      42%     85%     96%   0.29  0.34  0.46 0.24 0.43      2    90%   91%
                       5 KANSAS_CITY             100%          75%       53%         72%    100%       70%     75%     95%   0.67  0.24  0.56 0.40 0.46      2    57%   91%
                       6 FORT_WAYNE              100%          94%       35%         39%    100%       54%     86%     95%   0.57  0.37  0.40 0.49 0.45      2    26%   91%
                       7 SPRINGFIELD_IL          100%          98%        2%         46%    100%       48%     92%     94%   0.47  0.51  0.22 0.68 0.48      2    32%   90%
                       8 CLEVELAND                84%          70%       43%         85%      95%      81%     49%     93%   0.70  0.24  0.51 0.57 0.51      2    76%   90%
                       9 GARY                     41%          52%       65%         72%      64%      45%     58%     93%   0.72  0.18  0.42 0.42 0.50      2    57%   88%
                       10 TOLEDO                   87%          64%       35%         77%      92%      60%     62%     92%   0.61  0.39  0.34 0.66 0.46      2    64%   87%
                       11 LIMA                    100%          88%       13%         29%      90%      64%     62%     91%   0.38  0.63  0.24 0.71 0.46      2    20%   84%")




cities2 <- read.table(fill = T, header = F, text = "
                       1 MUSKEGON                 100%          48%       75%         49%     100%      38%     75%      86%  0.65   0.36  0.36 0.58 0.47      2    33%   76%
 2 BATTLE_CREEK             100%          90%       16%         26%     100%      61%     72%      86%  0.48   0.57  0.32 0.68 0.48      2    17%   75%
                      3 AKRON                     85%          80%       13%         53%      80%      53%     71%      85%  0.61   0.11  0.29 0.70 0.48      2    37%   74%
                      4 DETROIT                   60%          36%       48%         73%      79%      65%     57%      85%  0.78   0.17  0.52 0.48 0.51      2    54%   73%
                      5 JOLIET                    70%          66%       70%         81%      73%      54%     73%      85%  0.54   0.00  0.41 0.00 0.40      2    64%   71%
                      6 ROCKFORD                 100%          95%       29%         67%     100%      70%     71%      85%  0.50   0.44  0.37 0.52 0.48      2    48%   71%
                      7 SOUTHBEND                 95%          81%       48%         64%      95%      63%     71%      83%  0.50   0.49  0.47 0.50 0.48      2    45%   70%
                      8 INDIANAPOLIS              93%          83%       41%         27%      96%      42%     48%      83%  0.57   0.35  0.41 0.50 0.48      2    19%   70%
                      9 YOUNGSTOWN                70%          62%       35%         61%      83%      55%     68%      83%  0.67   0.39  0.49 0.53 0.48      2    44%   68%
                      10 DAYTON                    86%          47%       32%         57%      86%      25%     81%      82%  0.73   0.26  0.30 0.70 0.49      2    41%   67%
                       1 COLUMBUS                  91%          73%       40%         47%      89%      54%     68%      82%  0.63   0.34  0.41 0.56 0.45      2    32%   67%
 2 TERRE_HAUTE              100%         100%        0%          0%      99%      70%     60%      81%  0.39   0.76  0.31 0.78 0.46      2     0%   66%
                      3 PONTIAC                    1%          57%       84%         79%       1%      57%     97%      79%  0.58   0.27  0.50 0.38 0.47      2    59%   62%
                      4 FLINT                    100%          36%       52%         38%     100%      31%     78%      75%  0.63   0.28  0.25 0.62 0.49      2    21%   54%
                      5 MINNEAPOLIS               97%          82%       50%         53%      96%      63%     83%      73%  0.53   0.44  0.49 0.48 0.51      2    36%   46%
                      6 MILWAUKEE                 88%          77%       47%         53%      88%      75%     56%      72%  0.79   0.19  0.58 0.40 0.47      2    35%   45%
                      7 PORTSMOUTH               100%         100%        0%          0%     100%      86%     73%      70%  0.56   0.84  0.25 0.91 0.48      2     0%   37%
                      8 EVANSVILLE               100%          33%        8%         25%     100%      20%     78%      70%  0.50   0.65  0.27 0.80 0.45      2    17%   36%
                      9 BAY CITY                 100%         100%        0%          0%     100%      68%     19%      67%  0.40   0.84  0.24 0.86 0.46      2     0%   33%
                      10 SAGINAW                  100%          96%       61%         52%      73%      96%     79%      66%  0.60   0.27  0.32 0.46 0.46      2    29%   27%
                       1 CHICAGO                  100%          65%       58%         81%     100%      76%     49%      65%  0.81   0.11  0.62 0.27 0.53      2    54%   26%
 2 SPRINGFIELD_OH            98%          94%       14%         39%      96%      67%     69%      64%  0.51   0.54  0.30 0.66 0.44      2    20%   24%
                      3 MADISON                   99%         100%        1%         10%      91%      91%     50%      60%  0.13   0.62  0.43 0.59 0.47      2    13%   23%
                      4 ST_JOSEPH                 82%          49%       64%         75%     100%    100%       0%      54%  0.35   0.80  0.25 0.82 0.44      2    43%   17%
                      5 OSHKOSH                    0%         100%        0%          0%       0%      71%     19%      45%  0.15   0.90  0.11 0.90 0.43      2     0%   13%
                      6 RACINE                   100%         100%       21%         38%     100%      87%     56%      41%  0.42   0.46  0.37 0.48 0.43      2    16%    9%
                      7 DULUTH                   100%         100%        0%          0%     100%      78%     36%      16%  0.45   0.84  0.21 0.88 0.48      2     0%    0%
                      8 NEWPORT_NEWS               0%          84%       83%        100%       0%       0%   100%     100%   0.46   0.12  0.30 0.18 0.43      3    93%   95%
                      9 DURHAM                    85%          72%       66%        100%      85%      70%     61%    100%   0.57   0.16  0.42 0.25 0.48      3    93%   95%
                      10 MONTGOMERY                74%          53%       68%         99%     100%      92%     66%      99%  0.55   0.22  0.46 0.40 0.48      3    90%   95%
                       1 COLUMBUS                  73%          62%       66%         76%     100%      71%     79%      99%  0.61   0.21  0.38 0.40 0.49      3    45%   95%
 2 CHATTANOOGA               90%          65%       65%         76%      94%      66%     86%      97%  0.66   0.30  0.44 0.54 0.50      3    44%   95%
                      3 JACKSONVILLE             100%          78%       46%         90%     100%      76%     51%      94%  0.63   0.21  0.31 0.53 0.47      3    74%   95%
                      4 GREENSBORO               100%          98%       75%         93%     100%      98%     75%      93%  0.60   0.00  0.53 0.00 0.49      3    84%   95%
                      5 LYNCHBURG                100%          95%       84%        100%      99%      73%     96%    100%   0.47   0.44  0.20 0.62 0.49      3    94%   97%
                      6 LOUISVILLE               100%          78%       36%         57%     100%      73%     69%      92%  0.65   0.29  0.41 0.59 0.49      3    31%   94%
                      7 KNOXVILLE                 97%          87%       30%         36%      93%      63%     75%      91%  0.52   0.50  0.31 0.69 0.50      3    15%   94%
                      8 OKLAHOMA_CITY             30%          47%        0%         88%      13%      35%      0%      90%  0.53   0.00  0.44 0.00 0.47      3    70%   91%
                      9 WINSTON-SALEM            100%          54%       84%         97%     100%      55%     76%      86%  0.58   0.20  0.50 0.29 0.51      3    91%   84%
                      10 LEXINGTON                100%         100%       18%         41%     100%      71%     80%      85%  0.47   0.55  0.47 0.56 0.50      3    19%   84%
                      1 MIAMI                     44%          21%       91%         99%      93%      72%     74%      85%  0.81   0.07  0.52 0.14 0.56      3    93%   83%
2 CHARLOTTE                 96%          92%       56%         68%      97%      95%     59%      83%  0.69   0.21  0.56 0.38 0.50      3    38%   83%
                      3 MOBILE                   100%          86%       39%         84%     100%      97%     23%      80%  0.69   0.13  0.38 0.34 0.50      3    64%   82%
                      4 NORFOLK                   94%          86%       58%         83%      91%      75%     63%      88%  0.52   0.27  0.29 0.44 0.48      3    59%   89%
                      5 RICHMOND_VA               93%          78%       66%         90%      96%      80%     61%      87%  0.66   0.20  0.41 0.42 0.54      3    77%   88%")

cities3 <- read.table(fill = T, header = F, text = "
           1  TAMPA                    100%          84%       46%         83%     100%      84%     41%      79%   0.65    0.22    0.49  0.37  0.54      3    64%   88%
          2  BIRMINGHAM               100%          60%       75%         86%     100%      78%     73%      78%   0.69     0.16    0.51  0.38  0.50      3    67%    88%
           3  DALLAS                    95%          50%       94%         87%      96%      54%     93%      74%   0.77    0.12    0.69  0.17  0.54      3    70%   74%
           4  MACON                     20%          70%       71%         91%     100%      86%     57%      73%   0.54    0.22    0.32  0.37   0.50      3    82%   68%
           5  AUGUSTA                  100%          81%       50%         78%     100%      52%     48%      74%   0.50  0.30      0.35  0.46 0.47      3    67%   71%
           6  NEW_ORLEANS               85%          77%       49%         76%      96%      86%     45%      72%   0.66  0.21    0.35  0.48 0.57      3    65%   65%
           7  ATLANTA                  100%          87%       54%         82%     100%      89%     47%      72%   0.66  0.21      0.55  0.36 0.58      3    68%   63%
           8  ASHEVILLE                100%          96%         3%        42%     100%      84%     59%      70%   0.41  0.65    0.31  0.75 0.48      3    33%   61%
           9  BALTIMORE                 56%          39%       53%         69%      65%      42%     74%      69%   0.70  0.17    0.41  0.48 0.51      3    59%   53%
           10 WHEELING                 100%         100%         0%         0%     100%     100%      5%      67%   0.41  0.86    0.22  0.91 0.51      3     0%   50%
           11 ST_PETERSBURG            100%          81%       32%         39%     100%      95%     36%      56%   0.67  0.34    0.20  0.71 0.48      3    27%   33%
           12 ROANOKE                  100%         100%       24%         21%     100%      43%     70%      45%   0.59  0.41    0.38  0.65 0.46      3    21%   21%
           13 CHARLESTON_WV           100%          93%         5%         7%     100%      58%     14%      33%   0.46  0.68    0.23  0.78 0.53      3    15%   15%
           14 STOCKTON                  68%           6%      100%        100%      78%      25%     95%     100%   0.53  0.16    0.43  0.17 0.47      4    92%  100%
           15 OAKLAND                   99%          62%       71%         94%      99%      83%     50%      77%   0.58  0.23    0.58  0.20 0.52      4    91%   73%
           16 SAN_JOSE                  71%          63%       73%         91%      71%      89%     59%      76%   0.34  0.31    0.43  0.25 0.45      4    90%   70%
           17 SACRAMENTO                96%          72%       48%         54%      96%      71%     50%      67%   0.46  0.35    0.39  0.37 0.47      4    33%   44%
           18 PORTLAND                 100%         100%         4%         0%     100%      92%     49%      21%   0.47  0.64    0.31  0.68 0.49      4     0%    0%
           19 FRESNO                    65%           7%       98%        100%     100%      44%     91%      92%   0.43  0.13    0.38  0.14 0.48      4  100%   100%
           20 DENVER                   100%          95%       20%         67%     100%      94%     45%      91%   0.53  0.44    0.54  0.36 0.50      4    50%  100%
           21 SPOKANE                  100%         100%         0%         0%      93%      85%     50%      78%   0.23  0.82    0.14  0.83 0.47      4     0%  100%
           22 TACOMA                   100%          98%       23%         47%     100%      94%     42%      73%   0.31  0.54    0.34  0.53 0.45      4     0%  100%
           23 SAN_DIEGO                100%          94%       39%         90%      99%      91%     51%      70%   0.58  0.28    0.56  0.27 0.47      4  100%   100%
           24 LOS_ANGELES               75%          55%       77%         88%     100%      85%     46%      59%   0.69  0.14    0.64  0.14 0.53      4  100%   100%
           25 SAN_FRANCISCO             77%          22%       44%         69%      99%      91%     14%      54%   0.56  0.29    0.48  0.32 0.52      4  100%   100%
           26 SEATTLE                   98%          92%       50%         66%     100%      93%     31%      30%   0.60  0.43    0.36  0.56 0.48      4  100%   100%")

cities1 <- cities1[,-1]
cities2 <- cities2[,-1]
cities3 <- cities3[,-1]

cities <- rbind(cities1, cities2, cities3)

colnames(cities) <- c("city", "ANotMinority", "BNotMinority", "CMinority", "DMinority", "AMUI", "BMUI", "CLMI", "DLMI", "BID", "B/xPy", "HID", "H/xPy", "GINI", "Region", "PCTMIN", "PCTLMI")

cities$city <- tolower(cities$city)

cities$city <- str_replace(cities$city, "_", " ")

cities$city <- str_to_title(cities$city)



write_csv(cities, "holc.csv")


# after assemblage
holc$city[holc$city == "New York_city"] <- "New York"

ny_msa <- c("Brooklyn", "Huntington", "Newark", "Jersey City", "Edison")

pvia_2$city_holc <- pvia_2$city
pvia_2$city_holc[pvia_2$city_holc %in% ny_msa] <- "New York_msa"



as.character(holc[,c(2:17)])

convert_to_dec <- function(x){
  as.numeric(sub("%", "", holc[x,2]))/100
}

holc$ANotMinority <- map_dbl(seq_along(holc$city), convert_to_dec)

convert_to_dec <- function(x){
  as.numeric(sub("%", "", holc[x,3]))/100
}

holc$BNotMinority <- map_dbl(seq_along(holc$city), convert_to_dec)


convert_to_dec <- function(x){
  as.numeric(sub("%", "", holc[x,4]))/100
}

holc$CMinority <- map_dbl(seq_along(holc$city), convert_to_dec)

convert_to_dec <- function(x){
  as.numeric(sub("%", "", holc[x,5]))/100
}

holc$DMinority <- map_dbl(seq_along(holc$city), convert_to_dec)

holc$GINI <- as.numeric(holc$GINI)

convert_to_dec <- function(x){
  as.numeric(sub("%", "", holc[x,8]))/100
}

holc$CLMI <- map_dbl(seq_along(holc$city), convert_to_dec)

convert_to_dec <- function(x){
  as.numeric(sub("%", "", holc[x,9]))/100
}

holc$DLMI <- map_dbl(seq_along(holc$city), convert_to_dec)




